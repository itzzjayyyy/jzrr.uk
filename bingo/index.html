<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bingo Number Caller</title>

<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto+Condensed:wght@300;400;700&display=swap" rel="stylesheet">

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

/* THEME VARIABLES (default = your original) */
:root {
    --bg-gradient: linear-gradient(-45deg, #1a237e, #0d47a1, #64ffda, #00bcd4);
    --primary-accent: #64ffda;
    --secondary-accent: #00bcd4;
    --card-bg: rgba(0,0,0,0.35);
    --bubble-bg: rgba(0,0,0,0.7);
    --main-text-color: #e0e0e0;
    --button-bg: #64ffda;
    --button-text: #000000;
    --button-shadow-main: #64ffda;
    --button-shadow-secondary: #00bcd4;
}

/* Smooth fade when theme changes */
.theme-fade {
    animation: themeFade 0.55s ease-in-out;
}
@keyframes themeFade {
    from { opacity: 0; filter: blur(2px); }
    to   { opacity: 1; filter: blur(0); }
}

body {
    font-family: 'Roboto Condensed', sans-serif;
    color: var(--main-text-color);
    overflow-x: hidden;
    padding-bottom: 60px;
}

/* Background gradient */
.gradient-container {
    position: fixed;
    inset: 0;
    background: var(--bg-gradient);
    background-size: 400% 400%;
    animation: gradientBG 10s ease infinite;
    z-index: -2;
}

@keyframes gradientBG {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* THEME OVERLAY (snow, fireflies, confetti) */
#theme-overlay {
    position: fixed;
    inset: 0;
    z-index: -1;
    pointer-events: none;
    overflow: hidden;
}

/* Snow */
.snowflake {
    position: absolute;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: rgba(255,255,255,0.95);
    box-shadow: 0 0 6px rgba(255,255,255,0.9);
    animation-name: snowFall;
    animation-timing-function: linear;
    animation-iteration-count: infinite;
}
@keyframes snowFall {
    0% {
        transform: translate3d(0, -10vh, 0);
        opacity: 0;
    }
    10% {
        opacity: 1;
    }
    100% {
        transform: translate3d(0, 110vh, 0);
        opacity: 0;
    }
}

/* Fireflies */
.firefly {
    position: absolute;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255,255,0,1), rgba(255,255,0,0.1));
    box-shadow: 0 0 8px rgba(255,255,0,0.8);
    opacity: 0.9;
    animation-name: fireflyDrift;
    animation-timing-function: ease-in-out;
    animation-iteration-count: infinite;
}
@keyframes fireflyDrift {
    0%, 100% {
        transform: translate3d(0, 0, 0);
        opacity: 0.4;
    }
    25% {
        transform: translate3d(20px, -10px, 0);
        opacity: 1;
    }
    50% {
        transform: translate3d(-10px, 10px, 0);
        opacity: 0.6;
    }
    75% {
        transform: translate3d(15px, 5px, 0);
        opacity: 1;
    }
}

/* Confetti */
.confetti-piece {
    position: absolute;
    width: 8px;
    height: 16px;
    border-radius: 2px;
    background: #fff;
    opacity: 0.9;
    transform-origin: center;
    animation-name: confettiFall;
    animation-timing-function: linear;
    animation-iteration-count: infinite;
}
@keyframes confettiFall {
    0% {
        transform: translate3d(0, -15vh, 0) rotateZ(0deg);
        opacity: 0;
    }
    10% {
        opacity: 1;
    }
    100% {
        transform: translate3d(0, 110vh, 0) rotateZ(360deg);
        opacity: 0;
    }
}

/* Layout */
.hero {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    min-height: 100vh;
    color: white;
    padding-top: 40px;
}

.hero-content {
    animation: heroFadeInDown 1.1s ease-out;
    max-width: 600px;
}

@keyframes heroFadeInDown {
    from { opacity: 0; transform: translateY(-25px) scale(0.97); filter: blur(2px); }
    to   { opacity: 1; transform: translateY(0) scale(1);   filter: blur(0); }
}

.hero-content h1 {
    font-family: 'Orbitron', sans-serif;
    font-size: 3.2em;
    text-shadow: 0 0 15px var(--primary-accent), 0 0 30px var(--secondary-accent);
}

.hero-content p {
    margin-top: 10px;
    font-size: 1.15em;
    text-shadow: 0 0 8px var(--primary-accent);
}

/* Bingo card container */
.bingo-card {
    margin-top: 30px;
    background: var(--card-bg);
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 0 15px var(--primary-accent);
    width: 90%;
    max-width: 520px;
    animation: cardFloatIn 1s ease-out 0.15s both;
}

@keyframes cardFloatIn {
    from { opacity: 0; transform: translateY(30px) scale(0.97); filter: blur(3px); }
    to   { opacity: 1; transform: translateY(0)   scale(1);    filter: blur(0); }
}

.bingo-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 2.1em;
    color: var(--primary-accent);
    text-shadow: 0 0 10px var(--secondary-accent);
}

.bingo-subtitle {
    font-size: 1.05em;
    margin: 10px 0 20px;
    opacity: 0.9;
}

/* Current number */
#current-label {
    font-size: 1.1em;
    margin-top: 10px;
    opacity: 0.9;
}

#number {
    font-size: 4em;
    font-family: 'Orbitron', sans-serif;
    text-shadow: 0 0 15px var(--primary-accent), 0 0 25px var(--secondary-accent);
    margin-top: 8px;
    min-height: 1.2em;
}

/* Number animation styles */
.number-animated {
    animation-duration: 0.6s;
    animation-fill-mode: both;
}

/* 1) Pop */
.number-style-pop {
    animation-name: numberPop;
}
@keyframes numberPop {
    0% {
        transform: scale(0.4) rotateX(70deg);
        opacity: 0;
        filter: blur(4px);
    }
    55% {
        transform: scale(1.15) rotateX(0deg);
        opacity: 1;
        filter: blur(0);
    }
    100% {
        transform: scale(1) rotateX(0deg);
    }
}

/* 2) Slide in from left */
.number-style-slide {
    animation-name: numberSlide;
}
@keyframes numberSlide {
    0% {
        transform: translateX(-80px);
        opacity: 0;
        filter: blur(3px);
    }
    60% {
        transform: translateX(10px);
        opacity: 1;
        filter: blur(0);
    }
    100% {
        transform: translateX(0);
    }
}

/* 3) Spin in */
.number-style-spin {
    animation-name: numberSpin;
}
@keyframes numberSpin {
    0% {
        transform: scale(0) rotateZ(-360deg);
        opacity: 0;
    }
    70% {
        transform: scale(1.1) rotateZ(15deg);
        opacity: 1;
    }
    100% {
        transform: scale(1) rotateZ(0deg);
    }
}

/* 4) Bounce */
.number-style-bounce {
    animation-name: numberBounce;
}
@keyframes numberBounce {
    0%   { transform: translateY(-80px); opacity: 0; }
    60%  { transform: translateY(10px); opacity: 1; }
    80%  { transform: translateY(-6px); }
    100% { transform: translateY(0); }
}

/* 5) Zoom-fade */
.number-style-zoomfade {
    animation-name: numberZoomFade;
}
@keyframes numberZoomFade {
    0%   { transform: scale(2.4); opacity: 0; filter: blur(4px); }
    60%  { transform: scale(0.95); opacity: 1; filter: blur(0); }
    100% { transform: scale(1); }
}

/* Controls */
.bingo-controls {
    margin-top: 16px;
}

.bingo-controls button {
    padding: 12px 22px;
    font-size: 1.05em;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    margin: 8px;
    background: var(--button-bg);
    color: var(--button-text);
    box-shadow: 0 0 8px var(--button-shadow-main), 0 0 20px var(--button-shadow-secondary);
    transition: transform 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;
    animation: buttonPulse 2.8s ease-in-out infinite alternate;
}

@keyframes buttonPulse {
    from {
        transform: translateY(0) scale(1);
        box-shadow: 0 0 8px var(--button-shadow-main), 0 0 20px var(--button-shadow-secondary);
    }
    to {
        transform: translateY(-1px) scale(1.03);
        box-shadow: 0 0 14px var(--button-shadow-main), 0 0 28px var(--button-shadow-secondary);
    }
}

.bingo-controls button:hover:not(:disabled) {
    transform: translateY(-1px) scale(1.06);
    background: var(--secondary-accent);
}

.bingo-controls button:active:not(:disabled) {
    transform: translateY(1px) scale(0.97);
    box-shadow: 0 0 4px var(--button-shadow-main), 0 0 10px var(--button-shadow-secondary);
}

.bingo-controls button:disabled {
    background: #666;
    color: #222;
    box-shadow: none;
    animation: none;
}

/* Theme selector - styled pill */
.theme-controls {
    margin-top: 20px;
    display: inline-flex;
    gap: 10px;
    align-items: center;
    justify-content: center;
    padding: 10px 14px;
    border-radius: 999px;
    background: rgba(0,0,0,0.45);
    box-shadow: 0 0 10px rgba(0,0,0,0.4);
}

.theme-controls label {
    opacity: 0.9;
    font-size: 0.95em;
}

.theme-controls select {
    padding: 6px 14px;
    border-radius: 999px;
    border: 1px solid var(--primary-accent);
    background: rgba(0,0,0,0.7);
    color: var(--main-text-color);
    outline: none;
    font-family: inherit;
    font-size: 0.95em;
    box-shadow: 0 0 8px rgba(0,0,0,0.4);
}

/* History */
#history-title {
    font-size: 1.3em;
    color: var(--primary-accent);
    margin-top: 24px;
}

#history {
    margin-top: 10px;
}

/* History bubbles */
.bubble {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 56px;
    height: 56px;
    margin: 5px;
    border-radius: 50%;
    border: 2px solid var(--primary-accent);
    background: var(--bubble-bg);
    box-shadow: 0 0 10px var(--primary-accent), 0 0 20px var(--secondary-accent);
    animation-duration: 0.35s;
    animation-fill-mode: both;
}

.bubble-number {
    font-size: 1.15em;
    font-weight: 700;
}

/* History bubble animations */
.bubble-style-pop {
    animation-name: bubbleIn;
}
@keyframes bubbleIn {
    0% { transform: scale(0.1) translateY(10px); opacity: 0; filter: blur(3px); }
    70% { transform: scale(1.08) translateY(0); opacity: 1; filter: blur(0); }
    100% { transform: scale(1) translateY(0); }
}

.bubble-style-fade {
    animation-name: bubbleFade;
}
@keyframes bubbleFade {
    0% { opacity: 0; transform: scale(0.5); }
    100% { opacity: 1; transform: scale(1); }
}

.bubble-style-rise {
    animation-name: bubbleRise;
}
@keyframes bubbleRise {
    0% { transform: translateY(12px); opacity: 0; }
    100% { transform: translateY(0); opacity: 1; }
}

.bubble-style-pulse {
    animation-name: bubblePulse;
}
@keyframes bubblePulse {
    0%   { transform: scale(0.4); opacity: 0; }
    60%  { transform: scale(1.1); opacity: 1; }
    100% { transform: scale(1); }
}

/* Footer */
footer {
    text-align: center;
    padding: 15px 0;
    color: var(--primary-accent);
    text-shadow: 0 0 8px var(--secondary-accent);
}
</style>
</head>
<body>

<div class="gradient-container"></div>
<div id="theme-overlay"></div>

<div class="hero">

    <div class="hero-content">
        <h1>Bingo Number Caller</h1>
    </div>

    <div class="bingo-card">

        <h2 class="bingo-title">Ready when you are</h2>

        <!-- Current number -->
        <div id="current-wrapper">
            <div id="current-label">Current number:</div>
            <div id="number">--</div>
        </div>

        <!-- Controls -->
        <div class="bingo-controls">
            <button id="draw-btn" type="button">Next number</button>
            <button id="reset-btn" type="button">Start over</button>
            <button id="projector-btn" type="button">Open big-screen view</button>
        </div>

        <!-- Theme controls -->
        <div class="theme-controls">
            <label for="theme-select">Theme:</label>
            <select id="theme-select"></select>
        </div>

        <!-- History -->
        <h3 id="history-title">Numbers so far</h3>
        <div id="history"></div>

    </div>
</div>

<footer>Made privately for my dad üôÇ‚Äç‚ÜîÔ∏è</footer>
<script>
const TOTAL_NUMBERS = 90;

const numberEl     = document.getElementById("number");
const historyEl    = document.getElementById("history");
const drawBtn      = document.getElementById("draw-btn");
const resetBtn     = document.getElementById("reset-btn");
const projectorBtn = document.getElementById("projector-btn");
const themeSelect  = document.getElementById("theme-select");
const overlayMain  = document.getElementById("theme-overlay");

let remaining = [];
let history   = [];
let projectorWindow = null;
let currentThemeIndex = 0;
let currentNumberAnimClass = "number-style-pop";
let currentBubbleAnimClass = "bubble-style-pop";
let currentOverlayType = "none";

/* THEMES (Asteroid + Deep Sea removed) */
const themes = [
    {
        name: "Classic Neon (Default)",
        overlay: "none",
        vars: {
            "--bg-gradient": "linear-gradient(-45deg, #1a237e, #0d47a1, #64ffda, #00bcd4)",
            "--primary-accent": "#64ffda",
            "--secondary-accent": "#00bcd4",
            "--card-bg": "rgba(0,0,0,0.35)",
            "--bubble-bg": "rgba(0,0,0,0.7)",
            "--main-text-color": "#e0e0e0",
            "--button-bg": "#64ffda",
            "--button-text": "#000000",
            "--button-shadow-main": "#64ffda",
            "--button-shadow-secondary": "#00bcd4"
        },
        numberAnim: "number-style-pop",
        bubbleAnim: "bubble-style-pop"
    },
    {
        name: "Snowy Night",
        overlay: "snow",
        vars: {
            "--bg-gradient": "linear-gradient(160deg, #0d47a1, #1a237e, #000000)",
            "--primary-accent": "#ffffff",
            "--secondary-accent": "#bbdefb",
            "--card-bg": "rgba(15,15,40,0.85)",
            "--bubble-bg": "rgba(0,0,0,0.8)",
            "--main-text-color": "#e3f2fd",
            "--button-bg": "#bbdefb",
            "--button-text": "#0d47a1",
            "--button-shadow-main": "#bbdefb",
            "--button-shadow-secondary": "#ffffff"
        },
        numberAnim: "number-style-slide",
        bubbleAnim: "bubble-style-fade"
    },
    {
        name: "Firefly Meadow",
        overlay: "fireflies",
        vars: {
            "--bg-gradient": "linear-gradient(150deg, #001a00, #003300, #004d40)",
            "--primary-accent": "#cddc39",
            "--secondary-accent": "#aeea00",
            "--card-bg": "rgba(0, 20, 0, 0.85)",
            "--bubble-bg": "rgba(0,0,0,0.8)",
            "--main-text-color": "#e8f5e9",
            "--button-bg": "#cddc39",
            "--button-text": "#1b5e20",
            "--button-shadow-main": "#cddc39",
            "--button-shadow-secondary": "#aeea00"
        },
        numberAnim: "number-style-pop",
        bubbleAnim: "bubble-style-rise"
    },
    {
        name: "Confetti Party",
        overlay: "confetti",
        vars: {
            "--bg-gradient": "linear-gradient(135deg, #4a148c, #ff6f00, #d500f9)",
            "--primary-accent": "#ffd54f",
            "--secondary-accent": "#ff8a65",
            "--card-bg": "rgba(0,0,0,0.75)",
            "--bubble-bg": "rgba(0,0,0,0.85)",
            "--main-text-color": "#fff3e0",
            "--button-bg": "#ffd54f",
            "--button-text": "#4a148c",
            "--button-shadow-main": "#ffd54f",
            "--button-shadow-secondary": "#ff8a65"
        },
        numberAnim: "number-style-spin",
        bubbleAnim: "bubble-style-pop"
    }
];

/* Helper to apply theme vars to a document (main + projector) */
function applyThemeToDocument(doc, theme) {
    const rootStyle = doc.documentElement.style;
    Object.entries(theme.vars).forEach(([key, value]) => {
        rootStyle.setProperty(key, value);
    });
}

/* Build overlay in a given document based on type */
function buildOverlay(doc, type) {
    const overlay = doc.getElementById("theme-overlay");
    if (!overlay) return;

    overlay.innerHTML = "";
    if (type === "none") return;

    const count = (cls) => {
        switch (cls) {
            case "snow": return 80;
            case "fireflies": return 25;
            case "confetti": return 60;
            default: return 0;
        }
    };

    const total = count(type);

    for (let i = 0; i < total; i++) {
        const el = doc.createElement("div");
        if (type === "snow") {
            el.className = "snowflake";
            el.style.left = (Math.random() * 100) + "%";
            el.style.animationDuration = (8 + Math.random() * 10).toFixed(1) + "s";
            el.style.animationDelay = (-Math.random() * 10).toFixed(1) + "s";
        } else if (type === "fireflies") {
            el.className = "firefly";
            el.style.top = (Math.random() * 100) + "%";
            el.style.left = (Math.random() * 100) + "%";
            el.style.animationDuration = (6 + Math.random() * 6).toFixed(1) + "s";
            el.style.animationDelay = (-Math.random() * 6).toFixed(1) + "s";
        } else if (type === "confetti") {
            el.className = "confetti-piece";
            el.style.left = (Math.random() * 100) + "%";
            el.style.background = ["#ff1744", "#ffea00", "#00e5ff", "#ff9100", "#d500f9"][Math.floor(Math.random() * 5)];
            el.style.animationDuration = (5 + Math.random() * 6).toFixed(1) + "s";
            el.style.animationDelay = (-Math.random() * 6).toFixed(1) + "s";
        }
        overlay.appendChild(el);
    }
}

/* Theme change with fade (main + projector) */
function setTheme(index) {
    const theme = themes[index] || themes[0];
    currentThemeIndex = index;
    currentNumberAnimClass = theme.numberAnim;
    currentBubbleAnimClass = theme.bubbleAnim;
    currentOverlayType = theme.overlay || "none";

    // Fade main
    document.body.classList.remove("theme-fade");
    void document.body.offsetWidth;
    applyThemeToDocument(document, theme);
    buildOverlay(document, currentOverlayType);
    document.body.classList.add("theme-fade");

    // Projector (if open)
    if (projectorWindow && !projectorWindow.closed) {
        const pDoc = projectorWindow.document;
        pDoc.body.classList.remove("theme-fade");
        void pDoc.body.offsetWidth;
        applyThemeToDocument(pDoc, theme);
        buildOverlay(pDoc, currentOverlayType);
        pDoc.body.classList.add("theme-fade");

        if (history.length > 0) updateProjector(history[history.length - 1]);
        else updateProjector(null);
    }

    // Refresh current number + bubbles with new styles
    if (history.length > 0) {
        updateDisplay(history[history.length - 1]);
    } else {
        numberEl.textContent = "--";
    }
}

/* Init theme dropdown */
function initThemeSelect() {
    themes.forEach((t, idx) => {
        const opt = document.createElement("option");
        opt.value = idx;
        opt.textContent = t.name;
        themeSelect.appendChild(opt);
    });
    themeSelect.value = "0";

    themeSelect.addEventListener("change", () => {
        const idx = parseInt(themeSelect.value, 10) || 0;
        setTheme(idx);
    });
}

/* Game logic */
function initGame() {
    remaining = Array.from({ length: TOTAL_NUMBERS }, (_, i) => i + 1);
    history   = [];
    numberEl.textContent = "--";
    numberEl.className = "";
    historyEl.innerHTML = "";
    drawBtn.disabled = false;
    updateProjector(null);
}

function drawNumber() {
    if (remaining.length === 0) {
        alert("All numbers have been drawn. Game over ‚Äì time to check those cards! üéâ");
        drawBtn.disabled = true;
        return;
    }
    const i   = Math.floor(Math.random() * remaining.length);
    const num = remaining.splice(i, 1)[0];
    history.push(num);
    updateDisplay(num);
}

function updateDisplay(num) {
    numberEl.classList.remove("number-animated", currentNumberAnimClass);
    void numberEl.offsetWidth;
    numberEl.textContent = num;
    numberEl.classList.add("number-animated", currentNumberAnimClass);

    historyEl.innerHTML = "";
    history.forEach((n, index) => {
        const bubble = document.createElement("div");
        bubble.className = "bubble " + currentBubbleAnimClass;
        bubble.style.animationDelay = (index * 0.02) + "s";

        const numberSpan = document.createElement("div");
        numberSpan.className = "bubble-number";
        numberSpan.textContent = n;

        bubble.appendChild(numberSpan);
        historyEl.appendChild(bubble);
    });

    updateProjector(num);
}
/* PROJECTOR WINDOW */
function openProjector() {
    if (!projectorWindow || projectorWindow.closed) {
        projectorWindow = window.open("", "bingo_projector", "width=800,height=600");
        if (!projectorWindow) {
            alert("Please allow popups in your browser so the big-screen view can open.");
            return;
        }

        projectorWindow.document.write(`
            <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8">
                <title>Bingo ‚Äì Big Screen</title>
                <link rel="preconnect" href="https://fonts.googleapis.com">
                <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
                <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
                <style>
                    :root {
                        --bg-gradient: linear-gradient(-45deg, #1a237e, #0d47a1, #64ffda, #00bcd4);
                        --primary-accent: #64ffda;
                        --secondary-accent: #00bcd4;
                        --card-bg: rgba(0,0,0,0.35);
                        --bubble-bg: rgba(0,0,0,0.7);
                        --main-text-color: #e0e0e0;
                        --button-bg: #64ffda;
                        --button-text: #000000;
                        --button-shadow-main: #64ffda;
                        --button-shadow-secondary": "#00bcd4;
                    }
                    * { box-sizing: border-box; margin: 0; padding: 0; }
                    html, body {
                        margin: 0;
                        height: 100%;
                        font-family: 'Orbitron', system-ui, sans-serif;
                        color: #ffffff;
                        overflow: hidden;
                    }
                    .theme-fade {
                        animation: themeFade 0.55s ease-in-out;
                    }
                    @keyframes themeFade {
                        from { opacity: 0; filter: blur(2px); }
                        to   { opacity: 1; filter: blur(0); }
                    }
                    .background {
                        position: fixed;
                        inset: 0;
                        background: var(--bg-gradient);
                        background-size: 400% 400%;
                        animation: gradientBG 10s ease infinite;
                        z-index: -2;
                    }
                    @keyframes gradientBG {
                        0% { background-position: 0% 50%; }
                        50% { background-position: 100% 50%; }
                        100% { background-position: 0% 50%; }
                    }
                    #theme-overlay {
                        position: fixed;
                        inset: 0;
                        z-index: -1;
                        pointer-events: none;
                        overflow: hidden;
                    }
                    .snowflake {
                        position: absolute;
                        width: 6px;
                        height: 6px;
                        border-radius: 50%;
                        background: rgba(255,255,255,0.95);
                        box-shadow: 0 0 6px rgba(255,255,255,0.9);
                        animation-name: snowFall;
                        animation-timing-function: linear;
                        animation-iteration-count: infinite;
                    }
                    @keyframes snowFall {
                        0% {
                            transform: translate3d(0, -10vh, 0);
                            opacity: 0;
                        }
                        10% {
                            opacity: 1;
                        }
                        100% {
                            transform: translate3d(0, 110vh, 0);
                            opacity: 0;
                        }
                    }
                    .firefly {
                        position: absolute;
                        width: 6px;
                        height: 6px;
                        border-radius: 50%;
                        background: radial-gradient(circle, rgba(255,255,0,1), rgba(255,255,0,0.1));
                        box-shadow: 0 0 8px rgba(255,255,0,0.8);
                        opacity: 0.9;
                        animation-name: fireflyDrift;
                        animation-timing-function: ease-in-out;
                        animation-iteration-count: infinite;
                    }
                    @keyframes fireflyDrift {
                        0%, 100% {
                            transform: translate3d(0, 0, 0);
                            opacity: 0.4;
                        }
                        25% {
                            transform: translate3d(20px, -10px, 0);
                            opacity: 1;
                        }
                        50% {
                            transform: translate3d(-10px, 10px, 0);
                            opacity: 0.6;
                        }
                        75% {
                            transform: translate3d(15px, 5px, 0);
                            opacity: 1;
                        }
                    }
                    .confetti-piece {
                        position: absolute;
                        width: 8px;
                        height: 16px;
                        border-radius: 2px;
                        background: #fff;
                        opacity: 0.9;
                        transform-origin: center;
                        animation-name: confettiFall;
                        animation-timing-function: linear;
                        animation-iteration-count: infinite;
                    }
                    @keyframes confettiFall {
                        0% {
                            transform: translate3d(0, -15vh, 0) rotateZ(0deg);
                            opacity: 0;
                        }
                        10% {
                            opacity: 1;
                        }
                        100% {
                            transform: translate3d(0, 110vh, 0) rotateZ(360deg);
                            opacity: 0;
                        }
                    }
                    .wrapper {
                        position: relative;
                        z-index: 1;
                        height: 100%;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        text-align: center;
                        padding: 20px;
                    }
                    .label {
                        font-size: 3vw;
                        text-shadow: 0 0 10px var(--primary-accent), 0 0 20px var(--secondary-accent);
                        margin-bottom: 1rem;
                    }
                    #projector-number {
                        font-size: 20vw;
                        line-height: 1;
                        text-shadow: 0 0 30px var(--primary-accent), 0 0 60px var(--secondary-accent);
                    }

                    /* Projector number animations */
                    .number-animated {
                        animation-duration: 0.6s;
                        animation-fill-mode: both;
                    }
                    .number-style-pop {
                        animation-name: projNumberPop;
                    }
                    @keyframes projNumberPop {
                        0% {
                            transform: scale(0.4) rotateX(70deg);
                            opacity: 0;
                            filter: blur(4px);
                        }
                        55% {
                            transform: scale(1.15) rotateX(0deg);
                            opacity: 1;
                            filter: blur(0);
                        }
                        100% {
                            transform: scale(1) rotateX(0deg);
                        }
                    }
                    .number-style-slide {
                        animation-name: projNumberSlide;
                    }
                    @keyframes projNumberSlide {
                        0% {
                            transform: translateX(-80px);
                            opacity: 0;
                            filter: blur(3px);
                        }
                        60% {
                            transform: translateX(10px);
                            opacity: 1;
                            filter: blur(0);
                        }
                        100% {
                            transform: translateX(0);
                        }
                    }
                    .number-style-spin {
                        animation-name: projNumberSpin;
                    }
                    @keyframes projNumberSpin {
                        0% {
                            transform: scale(0) rotateZ(-360deg);
                            opacity: 0;
                        }
                        70% {
                            transform: scale(1.1) rotateZ(15deg);
                            opacity: 1;
                        }
                        100% {
                            transform: scale(1) rotateZ(0deg);
                        }
                    }
                    .number-style-bounce {
                        animation-name: projNumberBounce;
                    }
                    @keyframes projNumberBounce {
                        0%   { transform: translateY(-80px); opacity: 0; }
                        60%  { transform: translateY(10px); opacity: 1; }
                        80%  { transform: translateY(-6px); }
                        100% { transform: translateY(0); }
                    }
                    .number-style-zoomfade {
                        animation-name: projNumberZoomFade;
                    }
                    @keyframes projNumberZoomFade {
                        0%   { transform: scale(2.4); opacity: 0; filter: blur(4px); }
                        60%  { transform: scale(0.95); opacity: 1; filter: blur(0); }
                        100% { transform: scale(1); }
                    }

                    @media (max-width: 700px) {
                        .label { font-size: 5vw; }
                        #projector-number { font-size: 30vw; }
                    }
                </style>
            </head>
            <body>
                <div class="background"></div>
                <div id="theme-overlay"></div>
                <div class="wrapper">
                    <div class="label">The current number is:</div>
                    <div id="projector-number">--</div>
                </div>
            </body>
            </html>
        `);
        projectorWindow.document.close();

        setTimeout(() => {
            const theme = themes[currentThemeIndex] || themes[0];
            applyThemeToDocument(projectorWindow.document, theme);
            buildOverlay(projectorWindow.document, currentOverlayType);
            if (history.length > 0) updateProjector(history[history.length - 1]);
            else updateProjector(null);
        }, 50);
    } else {
        const theme = themes[currentThemeIndex] || themes[0];
        applyThemeToDocument(projectorWindow.document, theme);
        buildOverlay(projectorWindow.document, currentOverlayType);
        if (history.length > 0) updateProjector(history[history.length - 1]);
        else updateProjector(null);
    }
}

function updateProjector(num) {
    if (!projectorWindow || projectorWindow.closed) return;

    const doc = projectorWindow.document;
    const el  = doc.getElementById("projector-number");
    if (!el) return;

    // remove/restart animation
    el.classList.remove("number-animated", currentNumberAnimClass);
    void el.offsetWidth;

    el.textContent = (num == null ? "--" : String(num));

    el.classList.add("number-animated", currentNumberAnimClass);
}

/* EVENTS */
drawBtn.addEventListener("click", drawNumber);
resetBtn.addEventListener("click", () => initGame());
projectorBtn.addEventListener("click", openProjector);

/* INIT */
initThemeSelect();
setTheme(0);   // default = Classic Neon
initGame();
</script>

</body>
</html>